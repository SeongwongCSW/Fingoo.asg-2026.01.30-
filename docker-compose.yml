version: '3.8'

services:
  # [ì„œë¹„ìŠ¤ 1] ìš°ë¦¬ê°€ ë§Œë“  NestJS ì„œë²„
  app:
    container_name: fingoo-backend
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "3000:3000" # ë‚´ ì»´í“¨í„° 3000ë²ˆ -> ë„ì»¤ ë‚´ë¶€ 3000ë²ˆ ì—°ê²°
    env_file:
      - .env # .env íŒŒì¼ì„ ì½ì–´ì„œ í™˜ê²½ë³€ìˆ˜ë¡œ ë„£ì–´ì¤Œ
    environment:
      # ğŸš¨ ì¤‘ìš”: ë„ì»¤ ë‚´ë¶€ì—ì„œëŠ” 'localhost'ê°€ ì•„ë‹ˆë¼ ì„œë¹„ìŠ¤ ì´ë¦„('mysql_db')ìœ¼ë¡œ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.
      - DB_HOST=mysql_db
      # DBê°€ ì¼œì§€ê¸° ì „ì— ì„œë²„ê°€ ë¨¼ì € ì¼œì§€ë©´ ì£½ì„ ìˆ˜ ìˆìœ¼ë‹ˆ, ì£½ìœ¼ë©´ ë‹¤ì‹œ ì¼œë¼ê³  ì„¤ì •
      - TZ=Asia/Seoul
    restart: always
    depends_on:
      - mysql_db # DBê°€ ì¼œì§„ ë’¤ì— ì‹¤í–‰

  # [ì„œë¹„ìŠ¤ 2] MySQL ë°ì´í„°ë² ì´ìŠ¤
  mysql_db:
    image: mysql:8.0
    container_name: fingoo-mysql
    restart: always
    environment:
      # .env íŒŒì¼ì— ìˆëŠ” ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ ëŒì–´ë‹¤ ì”ë‹ˆë‹¤.
      MYSQL_ROOT_PASSWORD: ${DB_PASSWORD}
      MYSQL_DATABASE: ${DB_DATABASE}
      TZ: Asia/Seoul
    ports:
      - "3306:3306"
    volumes:
      # DB ê»ë‹¤ ì¼œë„ ë°ì´í„° ë‚ ì•„ê°€ì§€ ì•Šê²Œ ë‚´ ì»´í“¨í„°ì™€ ì—°ê²° (ë§ˆìš´íŠ¸)
      - ./db_data:/var/lib/mysql
    command: 
      # í•œê¸€ ê¹¨ì§ ë°©ì§€ ì„¤ì •
      --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

volumes:
  db_data: